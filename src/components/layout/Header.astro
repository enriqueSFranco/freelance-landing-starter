---
import ButtonMobileMenu from "@components/ui/ButtonMobileMenu.astro";
import { Image } from "astro:assets";

const menu = [
  { label: "Inicio", href: "#inicio" },
  { label: "Sobre nosotros", href: "#sobre-nosotros" },
  { label: "Cortes & Barba", href: "#cortes-barba" },
  { label: "Maestros del Filo", href: "#maestros-del-filo" },
  { label: "Galería de Estilos", href: "#galeria" },
  { label: "Dónde Estamos", href: "#ubicacion" },
];
---

<style is:inline>
  header {
    animation: header-appearance linear both;
    animation-timeline: scroll();
    animation-range: 0 100px;
  }

  #mobile-menu.is-open {
    opacity: 1;
    pointer-events: auto;
  }

  /* Animación de los enlaces en cascada */
  #mobile-menu.is-open .mobile-link {
    opacity: 1;
    transform: translateY(0);
  }

  /* Animación de los elementos extra (línea y redes) */
  #mobile-menu.is-open .mobile-item {
    opacity: 1;
  }

  /* Estilo para los links móviles */
  .mobile-link {
    position: relative;
  }

  /* Subrayado animado en hover para mobile */
  .mobile-link::after {
    content: "";
    position: absolute;
    bottom: -5px;
    left: 50%;
    width: 0;
    height: 1px;
    background-color: var(--color-accent);
    transition: all 0.3s ease;
    transform: translateX(-50%);
  }

  .mobile-link:hover::after {
    width: 100%;
  }

  @media (prefers-reduced-motion: reduce) {
    #nav-indicator,
    #mobile-menu,
    header {
      transition: none;
      animation: none;
    }
  }

  @keyframes header-appearance {
    to {
      height: 4.5rem;
      background-color: rgba(
        1,
        13,
        17,
        0.85
      );
      backdrop-filter: blur(12px);
      border-bottom-color: rgba(
        157,
        81,
        48,
        0.2
      );
    }
  }

  /* Estilos del Link Activo */
  .nav-link.is-active {
    color: var(--color-text-primary);
  }

  #nav-indicator {
    position: absolute;
    left: 0;
    pointer-events: none;
    transition:
      transform 0.4s cubic-bezier(0.23, 1, 0.32, 1),
      width 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    opacity: 0;
  }

  /* Menú Móvil */
  #mobile-menu.is-open {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }
</style>

<header
  role="banner"
  class="fixed top-0 left-0 w-full h-16 md:h-20 z-50 flex items-center transition-all duration-500 border-b border-transparent"
>
  <div class="container mx-auto px-4 md:px-8 flex items-center justify-between">
    <a href="/" class="relative z-50 group" aria-label="Ir a inicio">
      <Image width={64} height={64} src="/vintage-barber-logo.png" class="size-20 object-cover" alt="Barber Logo" />
    </a>

    <nav
      id="desktop-menu"
      class="hidden xl:flex items-center justify-center relative py-2 px-8 bg-black/20 backdrop-blur-md rounded-full border border-white/5"
    >
      {
        menu.map((item) => (
          <a
            href={item.href}
            data-section={
              item.href === "#" || item.href === "#inicio"
                ? "inicio"
                : item.href.replace("#", "")
            }
            class="nav-link px-4 py-2 text-[11px] uppercase tracking-[0.2em] font-bold text-(--color-text-muted) hover:text-(--color-text-primary) transition-colors"
          >
            {item.label}
          </a>
        ))
      }
      <span
        id="nav-indicator"
        class="absolute bottom-2 h-0.5 bg-(--color-accent) rounded-full shadow-[0_0_10px_var(--color-accent)]"
      ></span>
    </nav>

    <div class="flex items-center gap-4 relative z-50">
      <a
        href="#contacto"
        class="hidden sm:inline-block text-[10px] uppercase tracking-widest font-bold border border-(--color-accent) px-5 py-2 hover:bg-(--color-accent) hover:text-white transition-all"
      >
        Reservar
      </a>

      <div class="xl:hidden">
        <ButtonMobileMenu />
      </div>
    </div>
  </div>

  <div
    id="mobile-menu"
    class="fixed inset-0 w-full h-screen bg-(--color-bg-primary)/95 backdrop-blur-xl z-30 flex flex-col items-center justify-center transition-all duration-500 opacity-0 pointer-events-none"
  >
    

    <nav class="flex flex-col items-center gap-8">
      {
        menu.map((item, index) => (
          <a
            href={item.href}
            class="mobile-link text-3xl font-sancreek text-(--color-text-primary) opacity-0 translate-y-4 transition-all duration-500 hover:text-(--color-accent)"
            style={`transition-delay: ${index * 100}ms`}
          >
            {item.label}
          </a>
        ))
      }

      <div
        class="w-12 h-px bg-(--color-accent) my-4 opacity-0 transition-all duration-700 delay-500 mobile-item"
      >
      </div>

      <div
        class="flex gap-8 opacity-0 transition-all duration-700 delay-600 mobile-item"
      >
        <a
          href="#"
          class="text-(--color-text-primary) hover:text-(--color-accent)"
        >
          <svg width="28" height="28"
            ><use xlink:href="/sprite.svg#instagram-icon"></use></svg
          >
        </a>
        <a
          href="#"
          class="text-(--color-text-primary) hover:text-(--color-accent)"
        >
          <svg width="28" height="28"
            ><use xlink:href="/sprite.svg#whatsapp-icon"></use></svg
          >
        </a>
      </div>
    </nav>

    <div
      class="absolute bottom-10 left-1/2 -translate-x-1/2 text-[10px] uppercase tracking-[0.5em] text-(--color-accent) opacity-40"
    >
      Maestros del Filo
    </div>
  </div>
</header>

<script>
  import { initNavigation } from "../../scripts/navigation/initNavigation";
  initNavigation();
</script>
